{% extends "hesabyar/layout.html" %}
{% load static %}
{% block content %}



<div class="row">

    <div class="col-md-12">
        <div class="card mt-5" id="new-cost-app">
            <div class="card-header">
                <h4 class="text-center">
                    ثبت هزینه جدید
                    </h4>
            </div>
            <div class="card-body">
                <form @submit.prevent="add_cost()">

                    <div class="row">

                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="">عنوان

                                </label>


                                <input required type="text" class="form-control" v-model="title">

                            </div>


                        </div>


                   



                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="">هزینه کننده</label>
                                <select class="form-control" v-model="pay_from_id" name="" id="">
                                    {% for financial_account in financial_accounts %}
                                    <option value="{{financial_account.id}}">{{financial_account.title}}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="">هزینه برای</label>


                                <select v-model="pay_to_id" class="form-control">
                                        {% for financial_account in financial_accounts %}
                                        <option value="{{financial_account.id}}">{{financial_account.title}}</option>
                                        {% endfor %}
                                    </select>

                            </div>


                        </div>

                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="">هزینه برای</label>


                                <select v-model="cost_type" class="form-control">
                                        {% for cost_type in cost_types %}
                                        <option value="{{cost_type}}">{{cost_type}}</option>
                                        {% endfor %}
                                    </select>

                            </div>


                        </div>



                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="">تاریخ</label>

                                <div class="row">

                                    <div class="col-8">

                                        <date-picker v-model="transaction_datetime"></date-picker>

                                    </div>
                                </div>
                            </div>


                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="">مبلغ
                                    :
                                    <span v-text="to_price(amount)"></span>

                                </label>


                                <input required type="number" class="form-control" min="0" v-model="amount">

                            </div>


                        </div>
 

                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="">نحوه پرداخت</label>


                                <select v-model="payment_method" class="form-control">
                                    {% for payment_method in payment_methods %}
                                    <option value="{{payment_method}}">{{payment_method}}</option>

                                    {% endfor %}
                                </select>

                            </div>


                        </div>



                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="">توضیحات

                                </label>


                                <input type="text" class="form-control" v-model="description">

                            </div>


                        </div>


                        <div class="col-md-12 pt-4">
                            <div class="form-group">
                                <label for="">
                                </label>
                                <button class="btn px-5 btn-success" type="submit">افزودن</button>
                            </div>

                        </div>
                        <div class="col-md-12 text-right">
                            <div class="my-3 text-right" v-if="message.show">
                                <span :class="'alert alert-'+message.color">
                                    <span class="farsi" v-html="message.body"></span>
                                </span>
                            </div>
                        </div>
                    </div>
                </form>

            </div>
        </div>
    </div>
</div>
{% endblock content %}

{% block script %}

<script src="{% static 'persian/moment.js' %}"></script>
<script src="{% static 'persian/moment-jalaali.js' %}"></script>
<script src="{% static 'persian/vue-persian-datetime-picker-browser.js' %}"></script>


<script>
    let new_cost_app = new Vue({
        el: "#new-cost-app",
        data: {
            costs: [],
            pay_to_id: 0,
            pay_from_id: 0,
            amount: 0,
            transaction_datetime: current_date,
            payment_method: "",
            title: "",
            description: "",
            cost_type:"",
            message: { color: "success", body: "", show: false }
        },
        components: {
            DatePicker: VuePersianDatetimePicker,

        },
        methods: {
            to_price: function (vall) {
                return to_price(vall, "{{CURRENCY}}")
            },
            add_cost: function () {
                let payload = {
                    csrfmiddlewaretoken: csrfmiddlewaretoken,
                    pay_to_id: parseInt(this.pay_to_id),
                    pay_from_id: parseInt(this.pay_from_id),
                    title: this.title,
                    description: this.description,
                    cost_type: this.cost_type,
                    amount: parseInt(this.amount),
                    transaction_datetime: this.transaction_datetime,
                    payment_method: this.payment_method,

                }
                console.log(payload)
                let url = "{% url 'hesabyar:add_cost' %}"
                $.post(url, payload).done((data) => {

                    if (data.result === 'SUCCEED') {
                        this.message = { show: true, body: "با موفقیت ذخیره شد.", color: 'success' }
                    }
                    if (data.result === 'FAILED') {
                        console.log(data)
                        this.message = { show: true, body: "خطا در ذخیره سازی ", color: 'danger' }
                    }

                })

            }
        }
    })
</script>
{% endblock script %}