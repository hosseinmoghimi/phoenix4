{% extends "projectmanager/layout.html" %}

{% load static %}
{% load to_persian_date %}
{% load to_price %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h4 class="text-center">
            برگه انبار
        </h4>

    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <h4>
                    برگه انبار شماره
                    {{ware_house_sheet.id}}
                    {% if perms.projectmanager.change_warehousesheet %}
                    <a title="ویرایش" target="_blank" href="{{ware_house_sheet.get_edit_url}}">
                        <i class="material-icons">
                            edit
                        </i>
                    </a>
                    {% endif %}

                </h4>
                <h5 class="text-right">
                    انبار :
                    <a href="{{ware_house_sheet.ware_house.get_absolute_url}}">
                        <i class="material-icons">
                            apartment
                        </i>
                        {{ware_house_sheet.ware_house.title}}
                    </a>

                    <a href="{{ware_house_sheet.ware_house.employer.get_absolute_url}}">
                        <small class="mx-2 text-secondary">
                            <i class="material-icons">
                                store
                            </i>
                            {{ware_house_sheet.ware_house.employer.title}}

                        </small>
                    </a>





                </h5>

            </div>
            <div class="col-md-6">

                {% if ware_house_sheet.date_imported %}
                <p class="text-left">

                    تاریخ ورود به انبار :
                    {{ware_house_sheet.date_imported|to_persian_datetime|safe}}
                </p>
              

                {% endif %}


                {% if ware_house_sheet.date_exported %}
                <p class="text-left">

                    تاریخ خروج از انبار :
                    {{ware_house_sheet.date_exported|to_persian_datetime|safe}}
                </p>

                {% endif %}
                <p class="text-left">
                    <a href="{{ware_house_sheet.employee.get_absolute_url}}">
                        {{ware_house_sheet.employee.profile.name}}
                        <img src="{{ware_house_sheet.employee.profile.image}}" class="rounded-circle" width="48" alt="">
                    </a>
                </p>
            </div>
        </div>









        <table class="table table-striped">
            <thead>
                <th>

                </th>
                <th>
                    تاریخ درخواست
                </th>
                <th>
                    مسئول خرید
                </th>
                {% if not project %}

                <th>
                    پروژه
                </th>
                {% endif %}
                <th>
                    متریال
                </th>
                <th>
                    تعداد
                </th>
                <th>
                    قیمت واحد
                </th>
                <th>
                    جمع
                </th>
                <th>
                    وضعیت
                </th>
                <th>

                </th>
            </thead>
            <tbody>
                {% for material_request in ware_house_sheet.material_requests.all %}
                <tr>
                    <td>
                        <a target="_blank" href="{{material_request.get_absolute_url}}" title="نمایش کامل">
                            <i class="material-icons">
                                ballot
                            </i>
                        </a>
                    </td>
                    <td>
                        <small>

                            {{material_request.date_added|to_persian_date|safe}}
                        </small>
                    </td>
                    <td>
                        <a target="_blank" href="{{material_request.handler.get_absolute_url}}">
                            <img src="{{material_request.handler.profile.image}}" class="ml-2 rounded-circle" width="32"
                                alt="">
                            {{material_request.handler.profile.name}}
                        </a>
                    </td>
                    {% if not project %}

                    <td>

                        <a target="_blank" href="{{material_request.project.get_absolute_url}}">


                            {{material_request.project.title}}
                        </a>
                    </td>
                    {% endif %}
                    <td>

                        <a target="_blank" href="{{material_request.material.get_absolute_url}}">
                            <img src="{{material_request.material.thumbnail}}" class="ml-2 rounded" width="32" alt="">
                            {{material_request.material.title}}
                        </a>
                    </td>

                    <td>
                        {{material_request.quantity}}
                        <small>

                            {{material_request.unit_name}}
                        </small>

                    </td>
                    <td>
                        {{material_request.unit_price|to_price_pure}}

                    </td>
                    <td>
                        {{material_request.line_total|to_price}}

                    </td>
                    <td>
                        {{material_request.get_status_tag|safe}}


                        {% if perms.projectmanager.change_materialrequest %}
                        {{material_request.get_edit_btn|safe}}

                        {% endif %}
                    </td>
                    <td>

                    </td>
                </tr>
                {% endfor %}
                {% if add_material_request_form %}

                <tr v-for="material_request in material_requests">
                    <td>
                        <a target="_blank" :href="material_request.get_absolute_url" title="نمایش کامل">
                            <i class="material-icons">
                                ballot
                            </i>
                        </a>
                    </td>

                    <td>
                        <small v-text="material_request.persian_date_added">

                        </small>
                    </td>
                    <td>
                        <a target="_blank" :href="material_request.handler.get_absolute_url">
                            <img :src="material_request.handler.profile.image" class="ml-2 rounded" width="32" alt="">
                            <span v-text="material_request.handler.profile.name">
                            </span>
                        </a>
                    </td>
                    <td>
                        <img :src="material_request.material.thumbnail" class="ml-2 rounded" width="32" alt="">

                        <a target="_blank" :href="material_request.material.get_absolute_url"
                            v-text="material_request.material.title">

                        </a>
                    </td>
                    <td>
                        <span v-text="material_request.quantity"></span>
                        <small v-text="material_request.unit_name">

                        </small>

                    </td>
                    <td>
                        <span v-text="to_price(material_request.unit_price,'')"></span>

                    </td>
                    <td>
                        <span
                            v-text="to_price(material_request.unit_price*material_request.quantity,'{{CURRENCY}}')"></span>

                    </td>
                    <td>
                        <span v-html="material_request.get_status_tag"></span>


                        {% if perms.projectmanager.change_materialrequest %}
                        <a title="ویرایش" target="_blank" :href="material_request.get_edit_url">
                            <i class="material-icons">edit</i>
                        </a>
                        {% endif %}
                    </td>
                </tr>
                {% endif %}
            </tbody>
        </table>





    </div>
</div>

{% endblock content %}


{% block script %}

{% endblock script %}